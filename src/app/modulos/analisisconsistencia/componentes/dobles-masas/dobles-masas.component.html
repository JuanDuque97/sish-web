<!-- Miga de Pan.... -->
<div class="row text-right sish-miga-de-pan">
    <div class="col-md-12 text-right">
        <ol class="breadcrumb float-sm-right sish-miga-de-pan">
            <li class="breadcrumb-item active"> {{'Configuracion'|translate}}</li>
            <li class="breadcrumb-item">{{'Analisis'|translate}} {{'doblesMasas' | translate}}</li>
        </ol>
    </div>
</div>

<div class="container-fluid bg-white pt-5">
    <!-- Titulo.... -->
    <div class="row">
        <div class="col-md-12">
            <h2 class="sish-titulo-formulario">{{'Analisis'|translate}} {{' dobles masas' | translate}}</h2>
            <hr />
        </div>
    </div>

    <!-- Formulario.... -->
    <div class="modal-body">
        <div class="row"> 
        
         <form class="sish-form" #ngForm="ngForm" [formGroup]="formularioConsulta" (ngSubmit)="filtrar(idTipoElemento)" novalidate>
             <div class="row" width="100%">
                 
                 <div class="col-xl-3 col-lg-4 col-md-4 col-sm-12">
       
                     <div class="form-group" >
                         <label> {{ 'codigo' | translate }} IDEAM</label>
                         <ng-select2 name="codigoIDEAM" [data]="listaCodigoIDEAM"  [disabled]="!idTipoElemento"  [(ngModel)]="idElemento" formControlName="idCodigoIDEAM" [width]="'100%'" placeholder="{{ 'Seleccionar' | translate }} {{
                      ' codigo IDEAM' | translate
                      }}...">
                         </ng-select2>
                         <p *ngIf="ngForm.submitted && idElemento == '0'" class="error">
                            <sup>*</sup> {{ "Nombre" | translate }} {{ "obligatorio" | translate }}
                        </p>
                     </div>                   
     
                     <div class="form-group" >
                         <label> {{ 'codigo' | translate }} EAAB</label>
                         <ng-select2 name="CodigoEAAB" formControlName="idCodigoEAAB"  [disabled]="idTipoElemento !=466" [data]="listaCodigoEAAB" [(ngModel)]="idElemento" [width]="'100%'" placeholder="{{ 'Seleccionar' | translate }} {{
              ' codigo EAAB' | translate
              }}...">
                         </ng-select2>
                         <p *ngIf="ngForm.submitted && idElemento == '0'" class="error">
                            <sup>*</sup> {{ "Nombre" | translate }} {{ "obligatorio" | translate }}
                        </p>
                     </div> 
                      <div class="form-group">
                         <label> {{ 'Nombre' | translate }} elemento *</label>
                         <ng-select2 name="nombreElemento"   [data]="listaElemento"   (ngModelChange)="obtenerListaParametros($event)" 
                         formControlName="idElemento" [(ngModel)]="idElemento" [width]="'100%'" 
                          placeholder="{{ 'Seleccionar' | translate }}..." [disabled]="!idTipoElemento">
                         </ng-select2>
                         <p *ngIf="ngForm.submitted && idElemento == '0'" class="error">
                             <sup>*</sup> {{ "Nombre" | translate }} {{ "obligatorio" | translate }}
                         </p>
                     </div>
                 </div>


                 
                 <div class="col-xl-3 col-lg-4 col-md-4 col-sm-12">
                     <div class="form-group">
                         <label>{{ 'Parámetro'|translate}} *</label>
                         <ng-select2  [(ngModel)]="parametro"   name="idParametro" [data]="listParametro" (ngModelChange)="obtenerPorFrecuencia(idParametro)"   formControlName="idParametro" [width]="'100%'" placeholder="Seleccionar parametro ">
                         </ng-select2>
                         <p *ngIf="ngForm.submitted && parametro == 0" class="error">
                            <sup>*</sup> {{ "Parámetro" | translate }} {{ "obligatorio" | translate }}
                        </p>
                     </div>
     
                     <div class="form-group">
                         <label> {{ 'frecuencia' | translate }} * </label>
                         <ng-select2 name="idFrecuencia"     [disabled]=true  [(ngModel)]="idfrecuencia" [data]="listaFrecuencia" formControlName="frecuencia"   [width]="'100%'" placeholder="{{ 'Frecuencia' | translate }}...">
                         </ng-select2>
                         <p *ngIf="ngForm.submitted && idfrecuencia == 0" class="error">
                            <sup>*</sup> {{ "frecuencia" | translate }} {{ "obligatorio" | translate }}
                        </p>

                     </div>
     
     
                  
                 
                    
                 </div>
                  <div class="col-xl-4 col-lg-4 col-md-4 col-sm-12">
             
             
              <!--     Establecer rango de fecha 
                
                  <div class="form-group">
         
     
                     <br>
                     <div class="form-check form-check-inline">
                         <input  (change)="onPeriodoVigente()" formControlName="peridoId" class="form-check-input" type="radio"
                          value="1" [(ngModel)]="periodo" name="periodo" id="periodo">
                         <label class="form-check-label"
                          for="inperiodoRadio1">{{' Periodo disponible'|translate}}</label>
                     </div>
                     <div class="form-check form-check-inline">
                         <input     (change)="onEstablecerRango()"  formControlName="peridoId" class="form-check-input" 
                         type="radio"
                           value="2" [(ngModel)]="periodo" name="periodo" id="periodo">
                         <label class="form-check-label"
                         for="inperiodoRadio2">{{'establecer'|translate}} {{'rango'|translate}}</label>
                     </div>
                     <p *ngIf=" ngForm.submitted && periodo == 0" class="error">
                        <sup>*</sup> {{ "frecuencia" | translate }} {{ "obligatorio" | translate }}
                    </p>

                 </div>
 -->

              
          
       
                

                    <div class="form-group col-xl-6 col-lg-6 col-md-6 col-sm-12" *ngIf="idfrecuencia == 151 ||idfrecuencia == 146 ||idfrecuencia ==  145 ||idfrecuencia ==  683 ||idfrecuencia ==  682 ">
                        <label> {{ "Desde" | translate }} *</label>
                        <input type="datetime-local" 
                        class="form-control" formControlName="fechaInicio" [(ngModel)]="fecha" [max]=fechaActualHora name="fecha" placeholder="{{ 'fechaInstalacion' | translate }}" />
                        <p *ngIf="ngForm.submitted && fecha  == undefined " class="error">
                            <sup>*</sup> {{ "fecha" | translate }} {{ "obligatorio" | translate }}
                        </p>
                    </div>
                    <div class="form-group col-xl-6 col-lg-6 col-md-6 col-sm-12" *ngIf="idfrecuencia == 152">
                        <label> {{ "Desde" | translate }} *</label>
                        <input type="date" [max]=fechaActual  class="form-control" [(ngModel)]="fecha" formControlName="fechaInicio"   name="fecha" placeholder="{{ 'fechaInstalacion' | translate }}" />


                        <p *ngIf="ngForm.submitted && fecha  == undefined " class="error">
                            <sup>*</sup> {{ "fecha" | translate }} {{ "obligatorio" | translate }}
                        </p>
                    </div>

                    <div class="form-group col-xl-6 col-lg-6 col-md-6 col-sm-12"  *ngIf="idfrecuencia == 154 ">
                        <label> {{ 'Desde' | translate }} *</label>

                        <input type="month" [max]=fechaActualMensual name="fecha" id="fecha" [(ngModel)]="fechaMes" formControlName="fechaInicio" class="form-control">

                        <p *ngIf="ngForm.submitted && fechaMes  == undefined " class="error">
                            <sup>*</sup> {{ "fecha" | translate }} {{ "obligatorio" | translate }}
                        </p>

                    </div>
                    <div class="form-group col-xl-6 col-lg-6 col-md-6 col-sm-12" *ngIf="idfrecuencia == 155">
                        <label> {{ 'Desde' | translate }} *</label>
                        <ng-select2 name="idFlagObservacion"   [data]="listAnos" [(ngModel)]="fechaAno" formControlName="fechaInicio" [width]="'100%'" placeholder="{{ 'Seleccionar' | translate }} {{'año' | translate}}...">
                        </ng-select2>


                        <p *ngIf="ngForm.submitted && fechaAno  == undefined " class="error">
                            <sup>*</sup> {{ "fecha" | translate }} {{ "obligatorio" | translate }}
                        </p>


                        <input type="year" name="fecha" id="fecha" class="form-control">


                    </div>
                    

                <div class="form-group col-xl-6 col-lg-6 col-md-6 col-sm-12" *ngIf="idfrecuencia == 151 ||idfrecuencia == 146 ||idfrecuencia ==  145 ||idfrecuencia ==  683 ||idfrecuencia ==  682 ">
                    <label> {{ "Hasta" | translate }} *</label>
            <input type="datetime-local" class="form-control" formControlName="fechaFin"
                [(ngModel)]="fechaFinal" [max]=fechaActualHora name="fecha" placeholder="{{ 'fechaInstalacion' | translate }}" />
            <p *ngIf="ngForm.submitted && fecha  == undefined " class="error">
                <sup>*</sup> {{ "fecha" | translate }} {{ "obligatorio" | translate }}
            </p>
                    </div>
                    <div class="form-group col-xl-6 col-lg-6 col-md-6 col-sm-12" *ngIf="idfrecuencia == 152">
                        <label> {{ "Hasta" | translate }} *</label>
                        <input type="date" [max]=fechaActual  class="form-control" [(ngModel)]="fechaFinal" formControlName="fechaFin"   name="fecha" placeholder="{{ 'fechaInstalacion' | translate }}" />

                        <p *ngIf="ngForm.submitted && fecha  == undefined " class="error">
                            <sup>*</sup> {{ "fecha" | translate }} {{ "obligatorio" | translate }}
                        </p>
                    </div>

                    <div class="form-group col-xl-6 col-lg-6 col-md-6 col-sm-12"*ngIf="idfrecuencia == 154 ">
                        <label> {{ 'Hasta' | translate }} *</label>

                        <input type="month" [max]=fechaActualMensual name="fecha" id="fecha" [(ngModel)]="fechaMesFin" formControlName="fechaFin" class="form-control">

                        <p *ngIf="ngForm.submitted && fechaMes  == undefined " class="error">
                            <sup>*</sup> {{ "fecha" | translate }} {{ "obligatorio" | translate }}
                        </p>

                    </div>
                    <div class="form-group col-xl-6 col-lg-6 col-md-6 col-sm-12" *ngIf="idfrecuencia == 155">
                        <label> {{ 'Hasta' | translate }} *</label>
                        <ng-select2 name="idFlagObservacion"   [data]="listAnos" [(ngModel)]="fechaAnoFin" formControlName="fechaFin" [width]="'100%'" placeholder="{{ 'Seleccionar' | translate }} {{'año' | translate}}...">
                        </ng-select2>

                        <p *ngIf="ngForm.submitted && fechaAno  == undefined " class="error">
                            <sup>*</sup> {{ "Hasta " | translate }} {{ "obligatorio" | translate }}
                        </p>


                        <input type="year" name="fecha" id="fecha" class="form-control">


                    </div>

       
              
                
             </div>
           
                 <!--BOTONES-->
            
             </div>
             <br>
             <div class="row">

                 <div class="col-xl-4 col-lg-4 col-md-4 col-sm-12">
                     <label>{{ 'Elementos reprentativos' | translate }}</label>
                  
                     <br>
 
                     <div class="form-group" >
                         <label> {{ 'codigo' | translate }} IDEAM</label>
                         <ng-select2 name="listaCodigoIDEAMAgregar" [data]="listaCodigoIDEAMAgregar"   [disabled]="!idTipoElemento"  [(ngModel)]="idElementoAgregar"  formControlName="idCodigoIDEAMAgregar" [width]="'100%'" placeholder="{{ 'Seleccionar' | translate }} {{
                      ' codigo IDEAM' | translate
                      }}...">
                         </ng-select2>

                         <p *ngIf=" ngForm.submitted && !idElementoAgregar" class="error">
                            <sup>*</sup> {{ "frecuencia" | translate }} {{ "obligatorio" | translate }}
                        </p>
                     </div>                   
 
                     <div class="form-group" >
                         <label> {{ 'codigo' | translate }} EAAB</label>
                         <ng-select2 name="idCodigoEAABAgregar" formControlName="idCodigoEAABAgregar"   [disabled]="idTipoElemento !=466" [data]="listaCodigoEAABAgregar" [(ngModel)]="idElementoAgregar" [width]="'100%'" placeholder="{{ 'Seleccionar' | translate }} {{
              ' codigoEAAB' | translate
              }}...">
                         </ng-select2>

                         <p *ngIf=" ngForm.submitted && !idElementoAgregar" class="error">
                            <sup>*</sup> {{ "frecuencia" | translate }} {{ "obligatorio" | translate }}
                        </p>
                     </div> 
 
                      <div class="form-group">
                         <label> {{ 'Nombre' | translate }} elemento *</label>
                         <ng-select2 name="listaElementoAgregar" [data]="listaElementoAgregar" 
                          [disabled]="!idTipoElemento"  formControlName="ElementoAgregar"  [(ngModel)]="idElementoAgregar" 
                          [width]="'100%'" placeholder="{{ 'Seleccionar' | translate }}..." >
                         </ng-select2>
                         <p *ngIf=" ngForm.submitted && !idElementoAgregar" class="error">
                            <sup>*</sup> {{ "frecuencia" | translate }} {{ "obligatorio" | translate }}
                        </p>
                     </div>

                     <div  class="form-group text-center"> 
                         <a class="sish-boton-verde" title="Agregar">
                             <em class="fas fa-plus-circle"   disabled="idElemento == '0' && idfrecuencia == 0 "  (click)="buscarEstacion()"> </em>
                         </a>
                     </div>
                    
                 </div>
                 <div class="col-xl-8 col-lg-8 col-md-8 col-sm-12">
                 <div class="form-group text-center">
                     <table datatable class="sish-tabla">
                         <thead>
                             <tr>
                                 <th scope="col">ID </th>
                                 <th scope="col">Código estación IDEAM </th>
                                 <th scope="col">Código estación EAAB </th>
                             </tr>
                         </thead>
                         <tbody>
                             <tr class="text-center">
                                 <tr class="text-center" *ngFor="let dato of listaItemsElementos">
     
                                     <th scope="row"> {{dato.id}} </th>
                                     <th scope="row"> {{dato.codigoIDEAM }} </th>
                                     <th scope="row"> {{dato.nombreElemento }} </th>
                                 </tr>
                         </tbody>
                     </table>
                 </div>
             </div> 



             </div>   
             <div class="row">
                 <div class="form-group col-xl-12 col-lg-6 col-sm-12">
                     <div class="btn-group mr-2" role="group" aria-label="First group">
                         <button type="submit" class="sish-boton-confirmar"> 
             {{ 'Botones.consultar' | translate }}
             </button>
             <button type="button" class="sish-boton-cancelar" (click)="cancelar()"  > 
                 {{ 'Botones.limpiar' | translate }}
                 </button>
                     </div>
                 </div>
             </div>
         </form>
         <br>

        </div>


     </div>








    <div class="row" width="100%"   >
        <!--Primera columna -->

        <!--segunda columna -->
        <div class="col-xl-5 col-lg-12 col-md-12 col-sm-12">

            <div class="form-group">
                <div class="card border-info ">
                    <div class="row">
                        <div class="col-sm-12">
                            <div class="card">
                                <div class="card-body">
                                    <p class="card-text"><b>Serie de  </b></p>
                                    <p class="card-text">
                                        {{nombreParametro}}
                                    </p>
    
                                    <p class="card-text"><b>Estación</b></p>
                                    <p class="card-text">
                                    {{nombreEstacion}}
                                   </p>
                                    <p class="card-text"><b>Ecuación representativa</b></p>
                                    <p class="card-text">  
                                        {{nombreEstacionA}}
                                        {{nombreEstacionB}}
                                        {{nombreEstacionC}}
                                        {{nombreEstacionD}}
                                        {{nombreEstacionE}}

                                    </p>
                                   
    
                                    <p class="card-text"><b>Periodo de analisis</b></p>
                                    <p class="card-text">  
                                    {{formularioConsulta.value.fechaInicio1 }} - {{formularioConsulta.value.fechaFin1}}
                                    </p>
    
                                </div>
                            </div>
                        </div>
                      
                    </div>
    
                </div>
            </div>
        </div>
        <div class="col-xl-1 col-lg-12 col-md-12 col-sm-12">
            <div class="form-group">         
                <br>
                <br>
                <button [(ngModel)]="idElemento"  #ModalReporte data-toggle="modal"
                data-target="#ModalReporte" (click)="verDetalle()" >
                    <img src="https://thumbs.dreamstime.com/z/gr%C3%A1ficos-financieros-41675922.jpg"
                        style=" border:none; height:'100px'; width:'100px'; " />
                    <label class="form-check-label text-center">{{"Ver detalle de datos"|translate}}</label>
                </button>

            </div> 
          </div>
            <div class="col-xl-6 col-lg-12 col-md-12 col-sm-12">
                
                
            <div class="form-group">
                <div class="card border-info ">
                    <div class="row">
                        <div class="col-sm-12">
                            <div class="card">
                                <div class="card-body">
                                    <p class="card-text"><b>Factor de correlación </b></p>
                                    <p class="card-text">
                                        {{correlacion}}
                                    </p>
                                    <p class="card-text"><b>R2</b></p>
                                    <p class="card-text">
                                        {{r2}}
                                    </p>
                                    <p class="card-text"><b>Ecuación</b></p>
                                    <p class="card-text">
                                        {{ ecuacionString}}
                                    </p>
                                    <p class="card-text"><b>Periodo de ajuste</b></p>
                                    <p class="card-text">
                                        {{formularioConsulta.value.fechaInicio1 }} - {{formularioConsulta.value.fechaFin1}}
                                    </p>
                                    <p class="card-text"><b>Factor de ajuste</b></p>
                                    <p class="card-text">
                                        {{pediente2 }} 
                                    </p>
                                    <p class="card-text"><b>Pendiente 1</b></p>
                                    <p class="card-text">
                                        {{pediente1 }}
                                    </p>
                                    <p class="card-text"><b>Pendiente 2</b></p>
                                    <p class="card-text">
                                        {{pediente2 }}
                                    </p>
                                </div>
                            </div>
                        </div>
                     
                    </div>
    
                </div>
            </div>
        </div>


          


          <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12">

                <div class="form-group">
                    <div >
                        <highcharts-chart 
                                [Highcharts]="Highcharts"
                                [options]="chartOptions"
                                style="width: 100%; height: 60%; display: flex;" >
                            </highcharts-chart>
                           
                    </div>
                </div>

         </div>
     
       



        <button type="button" id="btn"  style="visibility: hidden;" (click)="infoAforo()">
        </button>

      
        </div> <div id="ModalReporte" class="modal fade" role="dialog">
            <div class="modal-dialog modal-lg">
                <!-- Modal content-->
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title">{{ "Detalle" |translate }} {{" datos" |translate}} </h4>
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                    </div>

                    <div class="modal-body">
                    <div class="row">

                        <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12">
                            <div class="form-group">
                                <div class="card border-info ">
                                    <div class="row">
                                        <div class="col-sm-12">
                                            <div class="card">
                                                <div class="card-body">
                                                    <p class="card-text"><b>Serie de  </b></p>
                                                    <p class="card-text">
                                                        {{nombreParametro}}
                                                    </p>
                                                    <p class="card-text"><b>Estación</b></p>
                                                    <p class="card-text">
                                                        {{nombreEstacion}}
                                                    </p>
                                                    <p class="card-text"><b>Ecuación representativa</b></p>
                                                    <p class="card-text">
                                                        {{nombreEstacionA}}
                                                        {{nombreEstacionB}}
                                                        {{nombreEstacionC}}
                                                        {{nombreEstacionD}}
                                                        {{nombreEstacionE}}
                                                    </p>
                                                    <p class="card-text"><b>Periodo de analisis</b></p>
                                                    <p class="card-text">
                                                        {{formularioConsulta.value.fechaInicio1 }} - {{formularioConsulta.value.fechaFin1}}
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                      +
                                    </div>
                    
                                </div>
                            </div>

                        </div>

                      
                    </div>
                    <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12">
                        <div class="form-group">
                            <div class="card border-info ">
                                <div class="row">
                                     <div class="col-xl-8 col-lg-8 col-md-8 col-sm-12">

                                            <div class="form-group text-center">

                                                    <app-datatable  *ngIf="tabla == '1'"  [datos]="listaDetalle" [opciones]="columnas" [id]="'fecha'" 
                                                    [consultarRegistros]="false" [editarRegistros]="false" [eliminarRegistros]="true" 
                                                    [cambiarEstadoRegistros]="false" (accion)="accionRegistroColumnas($event)" 
                                                    [verFiltros]="false" [verColumnas]="true" [crear]="false" [copiar]="true" [imprimir]="true" [excel]="true"
                                                    [seleccionarRegistro]="false">
                                                    </app-datatable>
                                                    <app-datatable *ngIf="tabla == '2'"  [datos]="listaDetalle" [opciones]="columnas1" [id]="'fecha'" 
                                                    [consultarRegistros]="false" [editarRegistros]="false" [eliminarRegistros]="true" 
                                                    [cambiarEstadoRegistros]="false" (accion)="accionRegistroColumnas($event)" 
                                                    [verFiltros]="false" [verColumnas]="true" [crear]="false" [copiar]="true" [imprimir]="true" [excel]="true"
                                                    [seleccionarRegistro]="false">
                                                    </app-datatable>
                                                    <app-datatable *ngIf="tabla == '3'"  [datos]="listaDetalle" [opciones]="columnas2" [id]="'fecha'" 
                                                    [consultarRegistros]="false" [editarRegistros]="false" [eliminarRegistros]="true" 
                                                    [cambiarEstadoRegistros]="false" (accion)="accionRegistroColumnas($event)" 
                                                    [verFiltros]="false" [verColumnas]="true" [crear]="false" [copiar]="true" [imprimir]="true" [excel]="true"
                                                    [seleccionarRegistro]="false">
                                                    </app-datatable>

                                                    <app-datatable *ngIf="tabla == '4'" [datos]="listaDetalle" [opciones]="columnas3" [id]="'fecha'" 
                                                    [consultarRegistros]="false" [editarRegistros]="false" [eliminarRegistros]="true" 
                                                    [cambiarEstadoRegistros]="false" (accion)="accionRegistroColumnas($event)" 
                                                    [verFiltros]="false" [verColumnas]="true" [crear]="false" [copiar]="true" [imprimir]="true" [excel]="true"
                                                    [seleccionarRegistro]="false">
                                                    </app-datatable>
                                                    

                                                    <app-datatable *ngIf="tabla == '5'" [datos]="listaDetalle" [opciones]="columnas4" [id]="'fecha'" 
                                                    [consultarRegistros]="false" [editarRegistros]="false" [eliminarRegistros]="true" 
                                                    [cambiarEstadoRegistros]="false" (accion)="accionRegistroColumnas($event)" 
                                                    [verFiltros]="false" [verColumnas]="true" [crear]="false" [copiar]="true" [imprimir]="true" [excel]="true"
                                                    [seleccionarRegistro]="false">
                                                    </app-datatable>


                                         
                                            </div>
                                        </div> 
                                    </div>
                                </div>
                       </div>
                    </div>
                  
                    <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12">

                        <div class="form-group">
                            <div >
                                <highcharts-chart 
                                        [Highcharts]="Highcharts"
                                        [options]="chartOptions1"
                                    
                                        style="width: 100%; height: 60%; display: flex;" >
                                    </highcharts-chart>
                                   
                            </div>
                        </div>
        
                 </div>

                
                      
                    </div>
                </div>
            </div>
        </div>


    </div>